<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quicksand">
        <style>
            #map {
                height: 500px;
                width: 500px;
            }
        </style>
    </head>

<body>
    <nav>
        <div class="nav-wrapper">
            <a href="index.html" class="brand-logo"><img id="logo-img" src="assets/Logo.png"></a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a id="nav-mobile-items" href="vendors.html">Vendors</a></li>
                <li><a id="nav-mobile-items" href="markets.html">Markets</a></li>
                <li><a id="nav-mobile-items" href="about.html">About</a></li>
                <li><a id="nav-mobile-items" href="contact.html">Contact</a></li>
                <li><a id="nav-mobile-items" href="maps.html">Maps</a></li>
            </ul>
        </div>
    </nav>
    <div class="parallax-container parallax-container-1">
        <div class="parallax"><img src="./assets/11apples-1841132_1280.jpg"></div>
    </div>
    <div class="section white">
        <div class="row container">
            <div class="col s6">
                <h2 id="card-title">Welcome!</h2>
                <p id="card-title">We're here to help you find local veggies, and get them on the table. Navigate through our centralized site to find local farmers markets, vendors, and their products.</p>
                <p id="card-title">Coming soon... Pre-order your veggies from our site, local vendors will have them ready for a convenient pick-up!</p>
            </div>
            <img class="col s5" id="home-map" src="assets/vegetable-2485063_1920.jpg">
            <div id="map"></div>
            <script>
                var map = null
                function initMap() {
                    var market = {lat: 47.6086, lng: -122.3406};
                    map = new google.maps.Map(
                        document.getElementById('map'), {zoom: 11, center: market});
                    var marker = new google.maps.Marker({position: market, map:map});
                }
                function addMarker(lat, lng, title) {
                    var marker = new google.maps.Marker({position: {lat:lat, lng:lng}, map:map, title: ""});
                    document.addEventListener('DOMContentLoaded', function () {
    var elems = document.querySelectorAll('.parallax');
    var instances = M.Parallax.init(elems);
});
var searchZip = "98103";
$("#search-address-button").on("click", "getCoordinatesFromAddress")
async function getMapsCenter() {
    // Location IQ gets the input of an address, and returns Coordinates
    // coordinates get dumped on addMarket
    $.ajax({
        type: "GET",
        url: "https://us1.locationiq.com/v1/search.php?key=3968761b6c52cf&postalcode=" + searchZip + "&format=json"
    }).then(function (addressResponse) {
        addMarkerCenter(addressResponse[0].lat, addressResponse[0].lon);
    });
};
// Function that runs a search on nearby markets based on Coordinates
function getUsdaResults() {
    $.ajax({
        type: "GET",
        contentType: "application/json; charset=utf-8",
        url: "http://search.ams.usda.gov/farmersmarkets/v1/data.svc/zipSearch?zip=" + searchZip,
        dataType: 'jsonp',
        // jsonpCallback: ‘searchResultsHandler’
    }).then(searchResultsHandler);
}
function searchResultsHandler(usdaResponse) {
    // console.log(usdaResponse);
    var results = usdaResponse.results;
    var myIdArr = [];
    var marketNameArr = [];
    var ix = 0;
    for (var i = 0; i < results.length; i++) {
        var item = results[i]
        myIdArr.push(item.id);
        marketNameArr.push(item.marketname.substring(4));
    }
    var timer = setInterval(function () {
        ix;
        var myIdUsda = myIdArr[ix]
        var marketName = marketNameArr[ix];
        $.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            url: "http://search.ams.usda.gov/farmersmarkets/v1/data.svc/mktDetail?id=" + myIdUsda,
            dataType: 'jsonp',
        }).then(function (detail) {
            var usdaMarketAddress = detail.marketdetails.Address;
            $.ajax({
                type: "GET",
                url: "https://us1.locationiq.com/v1/search.php?key=3968761b6c52cf&q=" + usdaMarketAddress + "&format=json"
            }).then(function (addressResponse) {
                var lat = addressResponse[0].lat
                var lng = addressResponse[0].lon
                addMarker(lat, lng, marketName, ix)
                ix = ix + 1
            });
        });
        if (ix == 4) {
            clearInterval(timer);
        };
    }, 550);
};
function addMarkerCenter(lat, lng) {
    console.log(lat);
    console.log(lng);
};
function addMarker(lat, lng, marketName, ix) {
    console.log(ix);
    console.log(lat);
    console.log(lng);
    console.log(marketName);
};
getMapsCenter();
getUsdaResults();
                }
            </script>
         </div>
    </div>
</div>
        <div class="footer2">
            <footer class="page-footer docs-footer">
              <div class="container2">
                  <div class="row" style="margin-bottom: 0;">
                      <div class="col s12 m10 offset-m1">
                          <div class="row">
                              <div class="col l4 s12">
                                  <h5>Help Our Veggies Grow</h5>
                                  <p id="card-title">Your support is much needed and appreciated. Our mission is to help
                                      vendors grow, and to help you find healthy, local produce.</p>
                                  <a class="btn waves-effect waves-light " href="/support-us.html">Support Us</a>
        
                              </div>
                              <div class="col l4 s12">
                                  <h5>Any comments?</h5>
                                  <p id="card-title">Have more questions or comments? Visit our chat room to talk with us.</p>
                                  <a class="btn waves-effect waves-light " target="_blank"
                                      href="https://gitter.im/Dogfalo/materialize">Chat</a>
                              </div>
                              <div class="col l4 s12" style="overflow: hidden;">
                                  <h5>Connect</h5>
                                  <iframe
                                      src="https://ghbtns.com/github-btn.html?user=dogfalo&repo=materialize&type=watch&count=true&size=large"
                                      allowtransparency="true" frameborder="0" scrolling="0" width="170" height="30"></iframe>
                                  <br>
                                  <a href="https://twitter.com/MaterializeCSS" class="twitter-follow-button"
                                      data-show-count="true" data-size="large" data-dnt="true" id="card-title">Follow @Wheresmyveggie</a>
                              </div>
                          </div>
        
                          <div class="row">
                              <div class="col s12">
                                  <h5>Patreon Sponsors</h5>
                              </div>
                              <div class="col s12">
                                  <div class="row">
                                      <div class=" col s2 patreon-footer-ad">
                                          <a href="https://kredittkrt.no/" alt="kredittkort" target="_blank" rel="noopener">
                                              <img class="footer-sponsors"
                                                  src="https://kredittkrt.no/wp-content/uploads/2016/02/kredittkrt-logo.png"
                                                  alt="kredittkort">
                                          </a>
                                      </div>
                                      <div class=" col s2 patreon-footer-ad ">
                                          <a href="https://www.santabarbarachocolate.com/" alt="Santa Barbara Chocolate"
                                              target="_blank" rel="noopener">
                                              <img class="footer-sponsors"
                                                  src="https://i.postimg.cc/j5cJ5Y99/SBChocolate-Logo-With-Alpha-768x768v4.png"
                                                  alt="Santa Barbara Chocolate">
                                          </a>
                                      </div>
                                      <div class=" col s2 patreon-footer-ad">
                                          <a href="https://netqualified.com/"
                                              alt="Notification widget for website engagement and conversion" target="_blank"
                                              rel="noopener">
                                              <img class="footer-sponsors"
                                                  src="https://netqualified.com/uploads/logo/008c4b17d2f7dffb207c95d34ab72eac.png"
                                                  alt="Notification widget for website engagement and conversion">
                                          </a>
                                      </div>
                                      <div class=" col s2 patreon-footer-ad">
                                          <a href="https://monovm.com/" alt="VPS Hosting" target="_blank" rel="noopener">
                                              <img class="footer-sponsors" src="https://i.postimg.cc/bvhm6D5J/monovm-logo.jpg"
                                                  alt="VPS Hosting">
                                          </a>
                                      </div>
                                      <div class=" col s2 patreon-footer-ad">
                                          <a href="https://clay.global/" target="_blank" rel="noopener">
                                              <img class="footer-sponsors"
                                                  src="https://i.postimg.cc/8knGJCYr/clay-logo-transp.png"
                                                  alt="UI UX Design Agency">
                                          </a>
                                      </div>
                                  </div>
                              </div>
                          </div>
        
                          <div class="footer-copyright">
                              © 2019-<noscript>2020</noscript>
                              <script type="text/javascript">
                                  document.write(new Date().getFullYear());
                              </script> Where's My Veggie, All rights reserved.
                          </div>
        
                      </div>
                  </div>
              </div>
          </footer>
        </div>
            <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwCl77BAAdSbQEH832zKMEOAQVYznq_8M&callback=initMap">
                </script>
          <script src="https://code.jquery.com/jquery.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
          <script src="script.js"></script>
        
</body>

</html>